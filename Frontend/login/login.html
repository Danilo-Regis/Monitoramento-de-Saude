<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>VivaBem Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap" rel="stylesheet" />
</head>

<body class="bg-white">
    <div class="flex flex-col items-center justify-center min-h-screen p-6">
        <div class="w-full max-w-sm">
            <div class="flex flex-col items-center mb-10">
                <div class="bg-blue-600 p-6 rounded-2xl mb-4">
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path clip-rule="evenodd"
                            d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                            fill-rule="evenodd"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-blue-800">VivaBem</h1>
            </div>
            <div class="space-y-4">
                <form id="loginForm" action="/login" method="POST" class="space-y-4">
                    <input name="email" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Email" type="email" />

                    <input name="password" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Senha" type="password" />
                    <div id="errorMessage"
                        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"></div>
                    <div class="mt-6 space-y-4">
                        <button type="submit"
                            class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                            Entrar
                        </button>
                    </div>
                </form>
                <button
                    class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"
                            fill="#EA4335"></path>
                        <path
                            d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v8.51h13.04c-.57 3.2-2.31 5.92-4.94 7.72l7.98 6.19c4.63-4.26 7.3-10.42 7.3-17.87z"
                            fill="#4285F4"></path>
                        <path
                            d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"
                            fill="#FBBC05"></path>
                        <path
                            d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.98-6.19c-2.11 1.42-4.81 2.27-7.91 2.27-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"
                            fill="#34A853"></path>
                        <path d="M0 0h48v48H0z" fill="none"></path>
                    </svg>
                    Cadastrar com o Google
                </button>
            </div>
            <div class="mt-6 text-center">
                <a class="text-sm text-blue-600 underline" href="#">Entrar como cuidador/Profissional</a>
            </div>
            <div class="mt-4 text-center">
                <a class="text-sm text-blue-600 underline" href="../Cadastro/cadastro.html">Não tem conta ?
                    Cadastre-se</a>
            </div>
        </div>
    </div>

    <script>
        let errorTimeout; // Variável para controlar o timeout

        // Função para mostrar mensagem de erro
        function showError(message) {
            const errorDiv = document.getElementById("errorMessage");
            errorDiv.textContent = message;
            errorDiv.classList.remove("hidden");

            // Limpa timeout anterior se existir
            if (errorTimeout) {
                clearTimeout(errorTimeout);
            }

            // Define timeout para esconder a mensagem após 8 segundos
            errorTimeout = setTimeout(() => {
                hideError();
            }, 8000);
        }

        // Função para esconder mensagem de erro
        function hideError() {
            const errorDiv = document.getElementById("errorMessage");
            errorDiv.classList.add("hidden");
            errorDiv.textContent = "";

            // Limpa o timeout
            if (errorTimeout) {
                clearTimeout(errorTimeout);
                errorTimeout = null;
            }
        }

        // Esconde a mensagem de erro quando a página carrega
        document.addEventListener("DOMContentLoaded", function () {
            hideError();
        });

        // Esconde a mensagem quando o usuário começar a digitar nos campos
        document.addEventListener("DOMContentLoaded", function () {
            const emailInput = document.querySelector('input[name="email"]');
            const passwordInput = document.querySelector('input[name="password"]');

            [emailInput, passwordInput].forEach(input => {
                input.addEventListener('input', hideError);
                input.addEventListener('focus', hideError);
            });
        });

        // Handler do formulário de login
        document.getElementById("loginForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            // Esconde qualquer mensagem de erro anterior
            hideError();

            const formData = new FormData(this);
            const data = Object.fromEntries(formData);

            try {
                const res = await fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await res.json();

                if (!result.success) {
                    showError(result.message);
                } else {
                    window.location.href = "/Registro/index.html";
                }
            } catch (error) {
                showError("Erro de conexão. Tente novamente.");
            }
        });
    </script>
</body>

</html>